(function(){"use strict";const I="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function E(n){return n.charCodeAt(0)-65}function d(n){return String.fromCharCode((n%26+26)%26+65)}function p(n){return n.toUpperCase().replace(/[^A-Z ]/g,"")}function h(n,t){return t===0?n:h(t,n%t)}function H(n,t=26){n=(n%t+t)%t;for(let e=1;e<t;e++)if(n*e%t===1)return e;return null}function T(){const n=[];for(let t=1;t<26;t++)h(t,26)===1&&n.push(t);return n}function P(n,t){return p(n).split("").map(e=>e===" "?" ":d(E(e)+t)).join("")}function N(n,t){return n.split("").map(e=>e===" "?" ":d(E(e)-t)).join("")}function te(n){const t=[],e=p(n);for(let r=0;r<26;r++){const c=N(e,r);t.push({key:r,keyDisplay:`Key = ${r}`,plaintext:c,score:0})}return t}function Y(n,t){if(h(t,26)!==1)throw new Error("Key must be coprime with 26");return p(n).split("").map(e=>e===" "?" ":d(E(e)*t)).join("")}function C(n,t){const e=H(t);return e===null?null:n.split("").map(r=>r===" "?" ":d(E(r)*e)).join("")}function ne(n){const t=[],e=p(n),r=T();for(const c of r){const o=C(e,c);o&&t.push({key:c,keyDisplay:`Key = ${c}`,plaintext:o,score:0})}return t}function v(n,t,e){if(h(t,26)!==1)throw new Error("a must be coprime with 26");return p(n).split("").map(r=>r===" "?" ":d(t*E(r)+e)).join("")}function M(n,t,e){const r=H(t);return r===null?null:n.split("").map(c=>c===" "?" ":d(r*(E(c)-e))).join("")}function re(n){const t=[],e=p(n),r=T();for(const c of r)for(let o=0;o<26;o++){const s=M(e,c,o);s&&t.push({key:{a:c,b:o},keyDisplay:`a = ${c}, b = ${o}`,plaintext:s,score:0})}return t}function K(n,t){const e=p(n).replace(/ /g,""),r=p(t).replace(/ /g,"");if(!r)throw new Error("Key cannot be empty");return e.split("").map((c,o)=>{const s=E(r[o%r.length]);return d(E(c)+s)}).join("")}function b(n,t){const e=p(t).replace(/ /g,"");return e?n.replace(/ /g,"").split("").map((r,c)=>{const o=E(e[c%e.length]);return d(E(r)-o)}).join(""):null}function ce(n){const t=n.replace(/[^A-Z]/g,""),e=t.length;if(e<=1)return 0;const r={};for(const o of t)r[o]=(r[o]||0)+1;let c=0;for(const o in r)c+=r[o]*(r[o]-1);return c/(e*(e-1))}function oe(n,t=15){const e=n.replace(/[^A-Z]/g,""),r=[];for(let c=1;c<=t;c++){let o=0;for(let s=0;s<c;s++){let l="";for(let i=s;i<e.length;i+=c)l+=e[i];o+=ce(l)}o/=c,r.push({keyLen:c,ic:o})}return r.sort((c,o)=>Math.abs(o.ic-.067)-Math.abs(c.ic-.067)),r.slice(0,5).map(c=>c.keyLen)}function se(n){const t=p(n).replace(/ /g,""),e=[],r=oe(t);for(const c of r){let o="";for(let l=0;l<c;l++){let i="";for(let u=l;u<t.length;u+=c)i+=t[u];let a=0,f=-1;for(let u=0;u<26;u++){const ee=(i.split("").map(ve=>d(E(ve)-u)).join("").match(/E/g)||[]).length;ee>f&&(f=ee,a=u)}o+=d(a)}const s=b(t,o);e.push({key:o,keyDisplay:`Key = "${o}" (len=${c})`,plaintext:s,score:0})}return e}function U(n){const t=p(n).replace(/ /g,"").replace(/J/g,"I"),e=new Set,r=[];for(const c of t+I.replace("J",""))e.has(c)||(e.add(c),r.push(c));return r}function O(n,t){const e=n.indexOf(t==="J"?"I":t);return{row:Math.floor(e/5),col:e%5}}function x(n,t){const e=U(t);let r=p(n).replace(/ /g,"").replace(/J/g,"I");const c=[];let o=0;for(;o<r.length;){let s=r[o],l=r[o+1]||"X";s===l?(l="X",o++):o+=2,c.push([s,l])}return c.map(([s,l])=>{const i=O(e,s),a=O(e,l);return i.row===a.row?e[i.row*5+(i.col+1)%5]+e[a.row*5+(a.col+1)%5]:i.col===a.col?e[(i.row+1)%5*5+i.col]+e[(a.row+1)%5*5+a.col]:e[i.row*5+a.col]+e[a.row*5+i.col]}).join("")}function D(n,t){const e=U(t),r=n.replace(/[^A-Z]/g,""),c=[];for(let o=0;o<r.length;o+=2)c.push([r[o],r[o+1]||"X"]);return c.map(([o,s])=>{const l=O(e,o),i=O(e,s);return l.row===i.row?e[l.row*5+(l.col+4)%5]+e[i.row*5+(i.col+4)%5]:l.col===i.col?e[(l.row+4)%5*5+l.col]+e[(i.row+4)%5*5+i.col]:e[l.row*5+i.col]+e[i.row*5+l.col]}).join("")}const le=["KEYWORD","SECRET","CIPHER","PLAYFAIR","MONARCHY","SECURITY","CRYPTOGRAPHY","HIDDEN","MESSAGE","PASSWORD","EXAMPLE","CHARLES"];function ie(n){const t=n.replace(/[^A-Z]/g,""),e=[];for(const r of le){const c=D(t,r);e.push({key:r,keyDisplay:`Key = "${r}"`,plaintext:c,score:0})}return e}function G(n,t,e=26){return[(n[0][0]*t[0]+n[0][1]*t[1])%e,(n[1][0]*t[0]+n[1][1]*t[1])%e].map(r=>(r%e+e)%e)}function ae(n,t=26){const r=((n[0][0]*n[1][1]-n[0][1]*n[1][0])%t%t+t)%t,c=H(r,t);return c===null?null:[[n[1][1]*c%t,(-n[0][1]*c%t+t)%t],[(-n[1][0]*c%t+t)%t,n[0][0]*c%t]].map(o=>o.map(s=>(s%t+t)%t))}function V(n,t){const e=p(n).replace(/ /g,""),r=e.length%2===0?e:e+"X";let c="";for(let o=0;o<r.length;o+=2){const s=[E(r[o]),E(r[o+1])],l=G(t,s);c+=d(l[0])+d(l[1])}return c}function w(n,t){const e=ae(t);if(!e)return null;const r=n.replace(/[^A-Z]/g,"");let c="";for(let o=0;o<r.length;o+=2){const s=[E(r[o]),E(r[o+1]||"X")],l=G(e,s);c+=d(l[0])+d(l[1])}return c}function ue(n){const t=n.replace(/[^A-Z]/g,""),e=[],r=T();for(const c of r.slice(0,6)){for(const o of r.slice(0,6)){for(let s=0;s<10;s++){for(let l=0;l<10;l++){const i=[[c,s],[l,o]],a=(c*o-s*l)%26;if(h(Math.abs(a),26)!==1)continue;const f=w(t,i);if(f&&e.push({key:i,keyDisplay:`[[${c},${s}],[${l},${o}]]`,plaintext:f,score:0}),e.length>=100)break}if(e.length>=100)break}if(e.length>=100)break}if(e.length>=100)break}return e}function Z(n,t){const e=p(n).replace(/ /g,"");if(t<2)return e;const r=Array(t).fill("").map(()=>[]);let c=0,o=1;for(const s of e)r[c].push(s),c+=o,(c===0||c===t-1)&&(o*=-1);return r.flat().join("")}function m(n,t){const e=n.replace(/[^A-Z]/g,""),r=e.length;if(t<2)return e;const c=Array(t).fill(0);let o=0,s=1;for(let u=0;u<r;u++)c[o]++,o+=s,(o===0||o===t-1)&&(s*=-1);const l=[];let i=0;for(let u=0;u<t;u++)l.push(e.slice(i,i+c[u]).split("")),i+=c[u];let a="";o=0,s=1;const f=Array(t).fill(0);for(let u=0;u<r;u++)a+=l[o][f[o]++],o+=s,(o===0||o===t-1)&&(s*=-1);return a}function fe(n){const t=n.replace(/[^A-Z]/g,""),e=[];for(let r=2;r<=Math.min(20,t.length);r++){const c=m(t,r);e.push({key:r,keyDisplay:`Rails = ${r}`,plaintext:c,score:0})}return e}function S(n,t){const e=p(n).replace(/ /g,""),r=p(t).replace(/ /g,""),c=r.length,o=Math.ceil(e.length/c),s=e.padEnd(o*c,"X"),l=[];for(let a=0;a<o;a++)l.push(s.slice(a*c,(a+1)*c));return r.split("").map((a,f)=>({c:a,i:f})).sort((a,f)=>a.c.localeCompare(f.c)).map(a=>a.i).map(a=>l.map(f=>f[a]).join("")).join("")}function A(n,t){const e=n.replace(/[^A-Z]/g,""),r=p(t).replace(/ /g,""),c=r.length,o=Math.ceil(e.length/c),s=r.split("").map((f,u)=>({c:f,i:u})).sort((f,u)=>f.c.localeCompare(u.c)).map(f=>f.i),l=Array(c).fill("");let i=0;for(const f of s)l[f]=e.slice(i,i+o),i+=o;let a="";for(let f=0;f<o;f++)for(let u=0;u<c;u++)l[u][f]&&(a+=l[u][f]);return a}const y=["KEY","SECRET","CIPHER","CODE","CRYPTO","HIDDEN","SECURE","PASSWORD","KEYWORD","ZEBRA","GERMAN","ENCODE","DECODE"];function pe(n){const t=n.replace(/[^A-Z]/g,""),e=[];for(const r of y){if(r.length>t.length)continue;const c=A(t,r);e.push({key:r,keyDisplay:`Key = "${r}"`,plaintext:c,score:0})}return e}function B(n,t,e){const r=S(n,t);return S(r,e)}function L(n,t,e){const r=A(n,e);return A(r,t)}function Ee(n){const t=n.replace(/[^A-Z]/g,""),e=[];for(const r of y.slice(0,5))for(const c of y.slice(0,5)){if(r.length>t.length||c.length>t.length)continue;const o=L(t,r,c);e.push({key:{key1:r,key2:c},keyDisplay:`Keys = "${r}", "${c}"`,plaintext:o,score:0})}return e}const $=["KEY","SECRET","CIPHER","LEMON","SECURE","CRYPTO","HIDDEN","PASSWORD","KEYWORD","ENCODE","DECODE","ALPHA","BETA"];function de(n,t,e){switch(t){case"additive":return P(n,e.k);case"multiplicative":return Y(n,e.k);case"affine":return v(n,e.a,e.b);case"vigenere":return K(n,e.word);case"playfair":return x(n,e.word);case"hill":return V(n,e.matrix);default:return n}}function ge(n,t,e){switch(t){case"additive":return N(n,e.k);case"multiplicative":return C(n,e.k);case"affine":return M(n,e.a,e.b);case"vigenere":return b(n,e.word);case"playfair":return D(n,e.word);case"hill":return w(n,e.matrix);default:return n}}function he(n,t,e){switch(t){case"railfence":return Z(n,e.rails);case"columnar":return S(n,e.word);case"double":return B(n,e.word1,e.word2);default:return n}}function Ae(n,t,e){switch(t){case"railfence":return m(n,e.rails);case"columnar":return A(n,e.word);case"double":return L(n,e.word1,e.word2);default:return n}}function j(n,t,e,r,c){const o=de(n,t,e),s=he(o,r,c);return{afterSubstitution:o,finalCipher:s}}function k(n,t,e,r,c){const o=Ae(n,r,c),s=ge(o,t,e);return{afterTransposition:o,plaintext:s}}function ye(n,t,e){return j(n,"vigenere",{word:t},"columnar",{word:e})}function Te(n,t,e){return k(n,"vigenere",{word:t},"columnar",{word:e})}function Oe(n,t="vigenere",e="columnar"){const r=n.replace(/[^A-Z]/g,""),c=[],o=t==="vigenere"?$.slice(0,5):t==="additive"?Array.from({length:26},(l,i)=>i):$.slice(0,5),s=e==="columnar"?y.slice(0,5):e==="railfence"?[2,3,4,5,6]:y.slice(0,5);for(const l of o)for(const i of s)try{let a,f,u;t==="vigenere"||t==="playfair"?a={word:l}:t==="additive"||t==="multiplicative"?a={k:l}:a={word:l},e==="railfence"?(f={rails:i},u=`Sub="${l}", Rails=${i}`):(f={word:i},u=`Sub="${l}", Trans="${i}"`);const{plaintext:Q}=k(r,t,a,e,f);c.push({key:{subKey:l,transKey:i},keyDisplay:u,plaintext:Q,score:0})}catch{}return c}function Se(n,t){const e=p(n).replace(/ /g,"");let r="",c=[t];for(let o=0;o<e.length;o++){const s=E(e[o]);o===0||E(e[o-1]),o>0&&c.push(E(e[o-1])),r+=d((s+(o===0?t:E(e[o-1])))%26)}return{ciphertext:r,keyStream:c}}function Re(n,t){const e=p(n).replace(/ /g,"");let r="",c=[t];for(let o=0;o<e.length;o++){const s=E(e[o]);o===0||E(r[o-1]),o>0&&c.push(E(r[o-1])),r+=d((s-(o===0?t:E(r[o-1]))+26)%26)}return{plaintext:r,keyStream:c}}function Ie(n){const t=p(n).replace(/ /g,"");let e="";const r=new Set;for(const c of t)r.has(c)||(e+=c,r.add(c));for(const c of I)r.has(c)||(e+=c);return e}function He(n,t){const e=p(n);let r="";for(const c of e)c===" "?r+=" ":r+=t[E(c)];return r}function Ne(n,t){const e=p(n);let r="";for(const c of e)c===" "?r+=" ":r+=I[t.indexOf(c)];return r}function X(n,t){const e=p(n).replace(/ /g,""),r=p(t).replace(/ /g,"");if(r.length<e.length)throw new Error("Key must be at least as long as plaintext");let c="";const o=[];for(let s=0;s<e.length;s++){const l=E(e[s]),i=E(r[s]),a=l^i;c+=d(a),o.push({plain:e[s],key:r[s],pNum:l,kNum:i,xor:a,cipher:d(a)})}return{ciphertext:c,steps:o}}function Ce(n,t){return X(n,t)}function Me(n,t){const e=p(n).replace(/ /g,""),r=Math.ceil(e.length/t),c=e.padEnd(r*t,"X");let o="";for(let s=0;s<t;s++)for(let l=0;l<r;l++)o+=c[l*t+s];return o}function _(n,t){const e=p(n).replace(/ /g,""),r=Math.ceil(e.length/t);let c="";for(let o=0;o<r;o++)for(let s=0;s<t;s++){const l=s*r+o;l<e.length&&(c+=e[l])}return c}function be(n){const t=[],e=p(n).replace(/ /g,"");for(let r=2;r<=Math.min(10,e.length);r++)if(e.length%r===0||e.length>r){const c=_(e,r);t.push({key:`${r} columns`,plaintext:c})}return t}const g={cleanText:p,getValidMultiplicativeKeys:T,encryptAdditive:P,decryptAdditive:N,bruteForceAdditive:te,encryptMultiplicative:Y,decryptMultiplicative:C,bruteForceMultiplicative:ne,encryptAffine:v,decryptAffine:M,bruteForceAffine:re,encryptVigenere:K,decryptVigenere:b,bruteForceVigenere:se,encryptPlayfair:x,decryptPlayfair:D,bruteForcePlayfair:ie,encryptHill:V,decryptHill:w,bruteForceHill:ue,encryptRailFence:Z,decryptRailFence:m,bruteForceRailFence:fe,encryptColumnar:S,decryptColumnar:A,bruteForceColumnar:pe,encryptDoubleTransposition:B,decryptDoubleTransposition:L,bruteForceDoubleTransposition:Ee,encryptProductCipher:ye,decryptProductCipher:Te,bruteForceProductCipher:Oe,encryptProductCipherFlexible:j,decryptProductCipherFlexible:k,encryptAutokey:Se,decryptAutokey:Re,generateMonoalphabeticKey:Ie,encryptMonoalphabetic:He,decryptMonoalphabetic:Ne,encryptVernam:X,decryptVernam:Ce,encryptSimpleTransposition:Me,decryptSimpleTransposition:_,bruteForceSimpleTransposition:be},F=["THE","AND","FOR","ARE","BUT","NOT","YOU","ALL","CAN","HAD","HER","WAS","ONE","OUR","OUT","HAS","HIS","HOW","ITS","LET","MAY","NEW","NOW","OLD","SEE","WAY","WHO","BOY","DID","GET","HIM","HIS","HOW","MAN","OWN","SAY","SHE","TWO","USE","IS","IT","BE","AS","AT","SO","WE","HE","BY","OR","ON","DO","IF","ME","MY","UP","AN","GO","NO","US","AM","TO","OF","IN","A","I","THAT","WITH","HAVE","THIS","WILL","YOUR","FROM","THEY","BEEN","CALL","COME","MADE","FIND","WERE","SAID","EACH","MAKE","LIKE","INTO","TIME","VERY","WHEN","MORE","SOME","THAN","THEM","WORD","WHAT","JUST","KNOW","TAKE","WELL","BACK","GOOD","HERE","ALSO","MUST","NAME","LONG","OVER","SUCH","LOOK","ONLY","YEAR","MOST","LAST","WORK","NEED","FEEL","EVEN","WANT","GIVE","THESE","FIRST","COULD","WOULD","THERE","THEIR","WHICH","ABOUT","OTHER","AFTER","THINK","BEING","WHERE","EVERY","GREAT","STILL","NEVER","THOSE","FOUND","UNDER","WHILE","AGAIN","WORLD","PLACE","SMALL","RIGHT","LITTLE","THREE","THING","STATE","NIGHT","HOUSE","PEOPLE","SHOULD","BEFORE","THROUGH","DIFFERENT","BETWEEN","BECAUSE","ANOTHER","HOWEVER","SOMETHING","WITHOUT","AGAINST","IMPORTANT","NOTHING","GOVERNMENT","TOGETHER","CHILDREN","MESSAGE","SECRET","ATTACK","SECURE","SYSTEM","CIPHER","CRYPTOGRAPHY","ENCRYPT","DECRYPT","HELLO","WORLD","PASSWORD","SECURITY","HIDDEN","PLAINTEXT","CIPHERTEXT","INFORMATION"],W={E:.127,T:.091,A:.082,O:.075,I:.07,N:.067,S:.063,H:.061,R:.06,D:.043,L:.04,C:.028,U:.028,M:.024,W:.024,F:.022,G:.02,Y:.02,P:.019,B:.015,V:.01,K:.008,J:.002,X:.002,Q:.001,Z:.001},q=["TH","HE","IN","ER","AN","RE","ON","AT","EN","ND","TI","ES","OR","TE","OF","ED","IS","IT","AL","AR","ST","TO","NT","NG","SE","HA","AS","OU","IO","LE","VE","CO","ME","DE","HI","RI","RO","IC","NE","EA","RA","CE","LI","CH","LL","BE","MA","SI","OM","UR"],J=["THE","AND","ING","HER","HAT","HIS","THA","ERE","FOR","ENT","ION","TER","WAS","YOU","ITH","VER","ALL","WIT","THI","TIO","EVE","OUR","ERS","ESS","AVE","ECT","ONE","IST","RES","OTH"];function De(n){const t={},e=n.replace(/[^A-Z]/g,""),r=e.length||1;for(const c of"ABCDEFGHIJKLMNOPQRSTUVWXYZ")t[c]=0;for(const c of e)t[c]++;for(const c in t)t[c]/=r;return t}function we(n){const t=De(n);let e=0;for(const c in W){const o=W[c],l=(t[c]||0)-o;e+=l*l/o}return Math.max(0,1-e/2)}function me(n){const t=n.replace(/[^A-Z]/g,"");if(t.length<2)return 0;let e=0,r=0;for(let c=0;c<t.length-1;c++){const o=t.substring(c,c+2);q.includes(o)&&e++,r++}return r>0?e/r:0}function Le(n){const t=n.replace(/[^A-Z]/g,"");if(t.length<3)return 0;let e=0,r=0;for(let c=0;c<t.length-2;c++){const o=t.substring(c,c+3);J.includes(o)&&e++,r++}return r>0?e/r:0}function ke(n){const t=n.split(/\s+/).filter(c=>c.length>0);if(t.length===0)return Fe(n.replace(/[^A-Z]/g,""));let e=0,r=0;for(const c of t){const o=c.replace(/[^A-Z]/g,""),s=Math.min(o.length,8);r+=s,F.includes(o)&&(e+=s)}return r>0?e/r:0}function Fe(n){let t=0;for(const e of F)e.length>=3&&n.includes(e)&&(t+=e.length);return Math.min(1,t/(n.length||1))}const R={dictionaryMatch:.5,letterFrequency:.25,bigramScore:.15,trigramScore:.1};function z(n){const t=ke(n),e=we(n),r=me(n),c=Le(n),o=R.dictionaryMatch*t+R.letterFrequency*e+R.bigramScore*r+R.trigramScore*c;return{composite:o,dictionary:t,frequency:e,bigram:r,trigram:c,confidence:Math.round(o*100)}}function We(n){for(const t of n){const e=z(t.plaintext);t.score=e.composite,t.confidence=e.confidence,t.analysis=e}return n.sort((t,e)=>e.score-t.score),n}const Pe={analyzeText:z,scoreResults:We,COMMON_WORDS:F,ENGLISH_FREQ:W,COMMON_BIGRAMS:q,COMMON_TRIGRAMS:J};self.addEventListener("message",function(n){const t=n.data;t.type==="crack"&&Ye(t)});function Ye(n){const{cipher:t,text:e,options:r}=n;let c=[];try{switch(self.postMessage({type:"progress",status:"starting",message:"Starting analysis..."}),t){case"additive":c=g.bruteForceAdditive(e);break;case"multiplicative":c=g.bruteForceMultiplicative(e);break;case"affine":c=g.bruteForceAffine(e);break;case"vigenere":c=g.bruteForceVigenere(e);break;case"playfair":c=g.bruteForcePlayfair(e);break;case"hill":c=g.bruteForceHill(e);break;case"railfence":c=g.bruteForceRailFence(e);break;case"columnar":c=g.bruteForceColumnar(e);break;case"double":c=g.bruteForceDoubleTransposition(e);break;case"product":self.postMessage({type:"progress",status:"working",message:"Crunching product cipher combinations..."});const s=(r==null?void 0:r.subType)||"vigenere",l=(r==null?void 0:r.transType)||"columnar";c=g.bruteForceProductCipher(e,s,l);break;default:throw new Error(`Unknown cipher: ${t}`)}self.postMessage({type:"progress",status:"analyzing",message:"Scoring candidates..."});const o=Pe.scoreResults(c);self.postMessage({type:"complete",results:o.slice(0,50)})}catch(o){self.postMessage({type:"error",message:o.message})}}})();
