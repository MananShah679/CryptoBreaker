(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();const O="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function k(e){return e.charCodeAt(0)-65}function b(e){return String.fromCharCode((e%26+26)%26+65)}function h(e){return e.toUpperCase().replace(/[^A-Z ]/g,"")}function T(e,t){return t===0?e:T(t,e%t)}function $(e,t=26){e=(e%t+t)%t;for(let n=1;n<t;n++)if(e*n%t===1)return n;return null}function M(){const e=[];for(let t=1;t<26;t++)T(t,26)===1&&e.push(t);return e}function pe(e,t){return h(e).split("").map(n=>n===" "?" ":b(k(n)+t)).join("")}function H(e,t){return e.split("").map(n=>n===" "?" ":b(k(n)-t)).join("")}function Te(e){const t=[],n=h(e);for(let r=0;r<26;r++){const a=H(n,r);t.push({key:r,keyDisplay:`Key = ${r}`,plaintext:a,score:0})}return t}function ye(e,t){if(T(t,26)!==1)throw new Error("Key must be coprime with 26");return h(e).split("").map(n=>n===" "?" ":b(k(n)*t)).join("")}function F(e,t){const n=$(t);return n===null?null:e.split("").map(r=>r===" "?" ":b(k(r)*n)).join("")}function Pe(e){const t=[],n=h(e),r=M();for(const a of r){const i=F(n,a);i&&t.push({key:a,keyDisplay:`Key = ${a}`,plaintext:i,score:0})}return t}function me(e,t,n){if(T(t,26)!==1)throw new Error("a must be coprime with 26");return h(e).split("").map(r=>r===" "?" ":b(t*k(r)+n)).join("")}function U(e,t,n){const r=$(t);return r===null?null:e.split("").map(a=>a===" "?" ":b(r*(k(a)-n))).join("")}function Ne(e){const t=[],n=h(e),r=M();for(const a of r)for(let i=0;i<26;i++){const o=U(n,a,i);o&&t.push({key:{a,b:i},keyDisplay:`a = ${a}, b = ${i}`,plaintext:o,score:0})}return t}function fe(e,t){const n=h(e).replace(/ /g,""),r=h(t).replace(/ /g,"");if(!r)throw new Error("Key cannot be empty");return n.split("").map((a,i)=>{const o=k(r[i%r.length]);return b(k(a)+o)}).join("")}function j(e,t){const n=h(t).replace(/ /g,"");return n?e.replace(/ /g,"").split("").map((r,a)=>{const i=k(n[a%n.length]);return b(k(r)-i)}).join(""):null}function Re(e){const t=e.replace(/[^A-Z]/g,""),n=t.length;if(n<=1)return 0;const r={};for(const i of t)r[i]=(r[i]||0)+1;let a=0;for(const i in r)a+=r[i]*(r[i]-1);return a/(n*(n-1))}function De(e,t=15){const n=e.replace(/[^A-Z]/g,""),r=[];for(let a=1;a<=t;a++){let i=0;for(let o=0;o<a;o++){let c="";for(let l=o;l<n.length;l+=a)c+=n[l];i+=Re(c)}i/=a,r.push({keyLen:a,ic:i})}return r.sort((a,i)=>Math.abs(i.ic-.067)-Math.abs(a.ic-.067)),r.slice(0,5).map(a=>a.keyLen)}function Me(e){const t=h(e).replace(/ /g,""),n=[],r=De(t);for(const a of r){let i="";for(let c=0;c<a;c++){let l="";for(let y=c;y<t.length;y+=a)l+=t[y];let d=0,p=-1;for(let y=0;y<26;y++){const B=(l.split("").map(P=>b(k(P)-y)).join("").match(/E/g)||[]).length;B>p&&(p=B,d=y)}i+=b(d)}const o=j(t,i);n.push({key:i,keyDisplay:`Key = "${i}" (len=${a})`,plaintext:o,score:0})}return n}function he(e){const t=h(e).replace(/ /g,"").replace(/J/g,"I"),n=new Set,r=[];for(const a of t+O.replace("J",""))n.has(a)||(n.add(a),r.push(a));return r}function R(e,t){const n=e.indexOf(t==="J"?"I":t);return{row:Math.floor(n/5),col:n%5}}function ge(e,t){const n=he(t);let r=h(e).replace(/ /g,"").replace(/J/g,"I");const a=[];let i=0;for(;i<r.length;){let o=r[i],c=r[i+1]||"X";o===c?(c="X",i++):i+=2,a.push([o,c])}return a.map(([o,c])=>{const l=R(n,o),d=R(n,c);return l.row===d.row?n[l.row*5+(l.col+1)%5]+n[d.row*5+(d.col+1)%5]:l.col===d.col?n[(l.row+1)%5*5+l.col]+n[(d.row+1)%5*5+d.col]:n[l.row*5+d.col]+n[d.row*5+l.col]}).join("")}function Y(e,t){const n=he(t),r=e.replace(/[^A-Z]/g,""),a=[];for(let i=0;i<r.length;i+=2)a.push([r[i],r[i+1]||"X"]);return a.map(([i,o])=>{const c=R(n,i),l=R(n,o);return c.row===l.row?n[c.row*5+(c.col+4)%5]+n[l.row*5+(l.col+4)%5]:c.col===l.col?n[(c.row+4)%5*5+c.col]+n[(l.row+4)%5*5+l.col]:n[c.row*5+l.col]+n[l.row*5+c.col]}).join("")}const Ke=["KEYWORD","SECRET","CIPHER","PLAYFAIR","MONARCHY","SECURITY","CRYPTOGRAPHY","HIDDEN","MESSAGE","PASSWORD","EXAMPLE","CHARLES"];function Oe(e){const t=e.replace(/[^A-Z]/g,""),n=[];for(const r of Ke){const a=Y(t,r);n.push({key:r,keyDisplay:`Key = "${r}"`,plaintext:a,score:0})}return n}function ke(e,t,n=26){return[(e[0][0]*t[0]+e[0][1]*t[1])%n,(e[1][0]*t[0]+e[1][1]*t[1])%n].map(r=>(r%n+n)%n)}function $e(e,t=26){const r=((e[0][0]*e[1][1]-e[0][1]*e[1][0])%t%t+t)%t,a=$(r,t);return a===null?null:[[e[1][1]*a%t,(-e[0][1]*a%t+t)%t],[(-e[1][0]*a%t+t)%t,e[0][0]*a%t]].map(i=>i.map(o=>(o%t+t)%t))}function be(e,t){const n=h(e).replace(/ /g,""),r=n.length%2===0?n:n+"X";let a="";for(let i=0;i<r.length;i+=2){const o=[k(r[i]),k(r[i+1])],c=ke(t,o);a+=b(c[0])+b(c[1])}return a}function q(e,t){const n=$e(t);if(!n)return null;const r=e.replace(/[^A-Z]/g,"");let a="";for(let i=0;i<r.length;i+=2){const o=[k(r[i]),k(r[i+1]||"X")],c=ke(n,o);a+=b(c[0])+b(c[1])}return a}function He(e){const t=e.replace(/[^A-Z]/g,""),n=[],r=M();for(const a of r.slice(0,6)){for(const i of r.slice(0,6)){for(let o=0;o<10;o++){for(let c=0;c<10;c++){const l=[[a,o],[c,i]],d=(a*i-o*c)%26;if(T(Math.abs(d),26)!==1)continue;const p=q(t,l);if(p&&n.push({key:l,keyDisplay:`[[${a},${o}],[${c},${i}]]`,plaintext:p,score:0}),n.length>=100)break}if(n.length>=100)break}if(n.length>=100)break}if(n.length>=100)break}return n}function ve(e,t){const n=h(e).replace(/ /g,"");if(t<2)return n;const r=Array(t).fill("").map(()=>[]);let a=0,i=1;for(const o of n)r[a].push(o),a+=i,(a===0||a===t-1)&&(i*=-1);return r.flat().join("")}function Z(e,t){const n=e.replace(/[^A-Z]/g,""),r=n.length;if(t<2)return n;const a=Array(t).fill(0);let i=0,o=1;for(let y=0;y<r;y++)a[i]++,i+=o,(i===0||i===t-1)&&(o*=-1);const c=[];let l=0;for(let y=0;y<t;y++)c.push(n.slice(l,l+a[y]).split("")),l+=a[y];let d="";i=0,o=1;const p=Array(t).fill(0);for(let y=0;y<r;y++)d+=c[i][p[i]++],i+=o,(i===0||i===t-1)&&(o*=-1);return d}function Fe(e){const t=e.replace(/[^A-Z]/g,""),n=[];for(let r=2;r<=Math.min(20,t.length);r++){const a=Z(t,r);n.push({key:r,keyDisplay:`Rails = ${r}`,plaintext:a,score:0})}return n}function D(e,t){const n=h(e).replace(/ /g,""),r=h(t).replace(/ /g,""),a=r.length,i=Math.ceil(n.length/a),o=n.padEnd(i*a,"X"),c=[];for(let d=0;d<i;d++)c.push(o.slice(d*a,(d+1)*a));return r.split("").map((d,p)=>({c:d,i:p})).sort((d,p)=>d.c.localeCompare(p.c)).map(d=>d.i).map(d=>c.map(p=>p[d]).join("")).join("")}function A(e,t){const n=e.replace(/[^A-Z]/g,""),r=h(t).replace(/ /g,""),a=r.length,i=Math.ceil(n.length/a),o=r.split("").map((p,y)=>({c:p,i:y})).sort((p,y)=>p.c.localeCompare(y.c)).map(p=>p.i),c=Array(a).fill("");let l=0;for(const p of o)c[p]=n.slice(l,l+i),l+=i;let d="";for(let p=0;p<i;p++)for(let y=0;y<a;y++)c[y][p]&&(d+=c[y][p]);return d}const S=["KEY","SECRET","CIPHER","CODE","CRYPTO","HIDDEN","SECURE","PASSWORD","KEYWORD","ZEBRA","GERMAN","ENCODE","DECODE"];function Ue(e){const t=e.replace(/[^A-Z]/g,""),n=[];for(const r of S){if(r.length>t.length)continue;const a=A(t,r);n.push({key:r,keyDisplay:`Key = "${r}"`,plaintext:a,score:0})}return n}function Ee(e,t,n){const r=D(e,t);return D(r,n)}function V(e,t,n){const r=A(e,n);return A(r,t)}function je(e){const t=e.replace(/[^A-Z]/g,""),n=[];for(const r of S.slice(0,5))for(const a of S.slice(0,5)){if(r.length>t.length||a.length>t.length)continue;const i=V(t,r,a);n.push({key:{key1:r,key2:a},keyDisplay:`Keys = "${r}", "${a}"`,plaintext:i,score:0})}return n}const de=["KEY","SECRET","CIPHER","LEMON","SECURE","CRYPTO","HIDDEN","PASSWORD","KEYWORD","ENCODE","DECODE","ALPHA","BETA"];function Ye(e,t,n){switch(t){case"additive":return pe(e,n.k);case"multiplicative":return ye(e,n.k);case"affine":return me(e,n.a,n.b);case"vigenere":return fe(e,n.word);case"playfair":return ge(e,n.word);case"hill":return be(e,n.matrix);default:return e}}function qe(e,t,n){switch(t){case"additive":return H(e,n.k);case"multiplicative":return F(e,n.k);case"affine":return U(e,n.a,n.b);case"vigenere":return j(e,n.word);case"playfair":return Y(e,n.word);case"hill":return q(e,n.matrix);default:return e}}function Ze(e,t,n){switch(t){case"railfence":return ve(e,n.rails);case"columnar":return D(e,n.word);case"double":return Ee(e,n.word1,n.word2);default:return e}}function Ve(e,t,n){switch(t){case"railfence":return Z(e,n.rails);case"columnar":return A(e,n.word);case"double":return V(e,n.word1,n.word2);default:return e}}function Ie(e,t,n,r,a){const i=Ye(e,t,n),o=Ze(i,r,a);return{afterSubstitution:i,finalCipher:o}}function W(e,t,n,r,a){const i=Ve(e,r,a),o=qe(i,t,n);return{afterTransposition:i,plaintext:o}}function We(e,t,n){return Ie(e,"vigenere",{word:t},"columnar",{word:n})}function Xe(e,t,n){return W(e,"vigenere",{word:t},"columnar",{word:n})}function _e(e,t="vigenere",n="columnar"){const r=e.replace(/[^A-Z]/g,""),a=[],i=t==="vigenere"?de.slice(0,5):t==="additive"?Array.from({length:26},(c,l)=>l):de.slice(0,5),o=n==="columnar"?S.slice(0,5):n==="railfence"?[2,3,4,5,6]:S.slice(0,5);for(const c of i)for(const l of o)try{let d,p,y;t==="vigenere"||t==="playfair"?d={word:c}:t==="additive"||t==="multiplicative"?d={k:c}:d={word:c},n==="railfence"?(p={rails:l},y=`Sub="${c}", Rails=${l}`):(p={word:l},y=`Sub="${c}", Trans="${l}"`);const{plaintext:x}=W(r,t,d,n,p);a.push({key:{subKey:c,transKey:l},keyDisplay:y,plaintext:x,score:0})}catch{}return a}function Ge(e,t){const n=h(e).replace(/ /g,"");let r="",a=[t];for(let i=0;i<n.length;i++){const o=k(n[i]);i===0||k(n[i-1]),i>0&&a.push(k(n[i-1])),r+=b((o+(i===0?t:k(n[i-1])))%26)}return{ciphertext:r,keyStream:a}}function Je(e,t){const n=h(e).replace(/ /g,"");let r="",a=[t];for(let i=0;i<n.length;i++){const o=k(n[i]);i===0||k(r[i-1]),i>0&&a.push(k(r[i-1])),r+=b((o-(i===0?t:k(r[i-1]))+26)%26)}return{plaintext:r,keyStream:a}}function ze(e){const t=h(e).replace(/ /g,"");let n="";const r=new Set;for(const a of t)r.has(a)||(n+=a,r.add(a));for(const a of O)r.has(a)||(n+=a);return n}function Qe(e,t){const n=h(e);let r="";for(const a of n)a===" "?r+=" ":r+=t[k(a)];return r}function et(e,t){const n=h(e);let r="";for(const a of n)a===" "?r+=" ":r+=O[t.indexOf(a)];return r}function we(e,t){const n=h(e).replace(/ /g,""),r=h(t).replace(/ /g,"");if(r.length<n.length)throw new Error("Key must be at least as long as plaintext");let a="";const i=[];for(let o=0;o<n.length;o++){const c=k(n[o]),l=k(r[o]),d=c^l;a+=b(d),i.push({plain:n[o],key:r[o],pNum:c,kNum:l,xor:d,cipher:b(d)})}return{ciphertext:a,steps:i}}function tt(e,t){return we(e,t)}function nt(e,t){const n=h(e).replace(/ /g,""),r=Math.ceil(n.length/t),a=n.padEnd(r*t,"X");let i="";for(let o=0;o<t;o++)for(let c=0;c<r;c++)i+=a[c*t+o];return i}function Ce(e,t){const n=h(e).replace(/ /g,""),r=Math.ceil(n.length/t);let a="";for(let i=0;i<r;i++)for(let o=0;o<t;o++){const c=o*r+i;c<n.length&&(a+=n[c])}return a}function rt(e){const t=[],n=h(e).replace(/ /g,"");for(let r=2;r<=Math.min(10,n.length);r++)if(n.length%r===0||n.length>r){const a=Ce(n,r);t.push({key:`${r} columns`,plaintext:a})}return t}const g={cleanText:h,getValidMultiplicativeKeys:M,encryptAdditive:pe,decryptAdditive:H,bruteForceAdditive:Te,encryptMultiplicative:ye,decryptMultiplicative:F,bruteForceMultiplicative:Pe,encryptAffine:me,decryptAffine:U,bruteForceAffine:Ne,encryptVigenere:fe,decryptVigenere:j,bruteForceVigenere:Me,encryptPlayfair:ge,decryptPlayfair:Y,bruteForcePlayfair:Oe,encryptHill:be,decryptHill:q,bruteForceHill:He,encryptRailFence:ve,decryptRailFence:Z,bruteForceRailFence:Fe,encryptColumnar:D,decryptColumnar:A,bruteForceColumnar:Ue,encryptDoubleTransposition:Ee,decryptDoubleTransposition:V,bruteForceDoubleTransposition:je,encryptProductCipher:We,decryptProductCipher:Xe,bruteForceProductCipher:_e,encryptProductCipherFlexible:Ie,decryptProductCipherFlexible:W,encryptAutokey:Ge,decryptAutokey:Je,generateMonoalphabeticKey:ze,encryptMonoalphabetic:Qe,decryptMonoalphabetic:et,encryptVernam:we,decryptVernam:tt,encryptSimpleTransposition:nt,decryptSimpleTransposition:Ce,bruteForceSimpleTransposition:rt},f={category:"substitution",cipherType:"additive",operations:new Set(["crack"]),isProcessing:!1},s={categoryBtns:document.querySelectorAll(".category-btn"),cipherBtns:document.querySelectorAll(".cipher-btn"),substitutionCiphers:document.getElementById("substitution-ciphers"),transpositionCiphers:document.getElementById("transposition-ciphers"),productCiphers:document.getElementById("product-ciphers"),symmetricCiphers:document.getElementById("symmetric-ciphers"),asymmetricCiphers:document.getElementById("asymmetric-ciphers"),mathTools:document.getElementById("math-tools"),productSubCipher:document.getElementById("product-sub-cipher"),productTransCipher:document.getElementById("product-trans-cipher"),opEncrypt:document.getElementById("op-encrypt"),opDecrypt:document.getElementById("op-decrypt"),opCrack:document.getElementById("op-crack"),encryptInputs:document.getElementById("encrypt-inputs"),crackInputs:document.getElementById("crack-inputs"),plaintextInput:document.getElementById("plaintext-input"),ciphertextInput:document.getElementById("ciphertext-input"),keyInputs:document.getElementById("key-inputs"),executeBtn:document.getElementById("execute-btn"),btnText:document.getElementById("btn-text"),clearBtn:document.getElementById("clear-btn"),quickBtns:document.querySelectorAll(".quick-btn"),encryptionOutput:document.getElementById("encryption-output"),cipherResult:document.getElementById("cipher-result"),resultsSection:document.getElementById("results-section"),emptyState:document.getElementById("empty-state"),loadingState:document.getElementById("loading-state"),topCandidates:document.getElementById("top-candidates"),candidatesContainer:document.getElementById("candidates-container"),allResultsToggle:document.getElementById("all-results-toggle"),toggleAllBtn:document.getElementById("toggle-all-btn"),allResults:document.getElementById("all-results"),allResultsContainer:document.getElementById("all-results-container"),toastContainer:document.getElementById("toast-container")};function at(e,t="info"){if(!s.toastContainer)return;const n=document.createElement("div");n.className=`toast ${t}`,n.innerHTML=`<span>${t==="error"?"!":t==="success"?"✓":"i"}</span> ${e}`,s.toastContainer.appendChild(n),requestAnimationFrame(()=>{n.classList.add("show")}),setTimeout(()=>{n.classList.remove("show"),setTimeout(()=>n.remove(),300)},3e3)}window.alert=e=>at(e,"error");function it(){s.categoryBtns.forEach(e=>{e.addEventListener("click",()=>Be(e.dataset.category))}),s.cipherBtns.forEach(e=>{e.addEventListener("click",()=>_(e.dataset.cipher))}),s.productSubCipher.addEventListener("change",N),s.productTransCipher.addEventListener("change",N),s.opEncrypt.addEventListener("change",L),s.opDecrypt.addEventListener("change",L),s.opCrack.addEventListener("change",L),s.quickBtns.forEach(e=>{e.addEventListener("click",()=>dt(e.dataset.cipher,e.dataset.text))}),s.executeBtn.addEventListener("click",ut),s.clearBtn.addEventListener("click",Et),s.toggleAllBtn.addEventListener("click",vt),document.getElementById("theme-toggle").addEventListener("click",It),wt(),N(),L(),ct(),st()}let w=[];function st(){const e=document.getElementById("history-panel"),t=document.getElementById("history-toggle"),n=document.getElementById("close-history"),r=document.getElementById("clear-history"),a=document.getElementById("export-history");e&&(t.addEventListener("click",()=>e.classList.add("active")),n.addEventListener("click",()=>e.classList.remove("active")),r.addEventListener("click",()=>{w=[],xe()}),a&&a.addEventListener("click",ot))}function ot(){if(w.length===0)return;const e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(w,null,2)),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download","cryptobreaker_session_"+new Date().toISOString().slice(0,10)+".json"),document.body.appendChild(t),t.click(),t.remove()}function X(e,t,n,r={}){const a={id:Date.now(),timestamp:new Date().toLocaleTimeString(),type:e,cipherType:f.cipherType,input:t.substring(0,50)+(t.length>50?"...":""),fullInput:t,result:n?typeof n=="string"?n.substring(0,50)+"...":"Analysis Results":"",fullResult:n,details:r};w.unshift(a),w.length>20&&w.pop(),xe()}function xe(){const e=document.getElementById("history-list");if(e){if(w.length===0){e.innerHTML='<div class="history-empty">No operations yet</div>';return}e.innerHTML=w.map(t=>`
        <div class="history-item" onclick="restoreHistory(${t.id})">
            <div class="history-item-header">
                <span>${t.timestamp}</span>
                <span>${t.cipherType}</span>
            </div>
            <div class="history-item-title">${t.type}</div>
            <div class="history-item-preview">In: ${t.input}</div>
            <div class="history-item-preview">Out: ${t.result}</div>
        </div>
    `).join("")}}function ct(){ue("plaintext-drop-zone","plaintext-input"),ue("ciphertext-drop-zone","ciphertext-input")}function ue(e,t){const n=document.getElementById(e),r=document.getElementById(t);if(!n||!r)return;["dragenter","dragover","dragleave","drop"].forEach(i=>{n.addEventListener(i,a,!1)});function a(i){i.preventDefault(),i.stopPropagation()}["dragenter","dragover"].forEach(i=>{n.addEventListener(i,()=>n.classList.add("drag-over"),!1)}),["dragleave","drop"].forEach(i=>{n.addEventListener(i,()=>n.classList.remove("drag-over"),!1)}),n.addEventListener("drop",i=>{const c=i.dataTransfer.files;lt(c,r)},!1)}function lt(e,t){if(e.length===0)return;const n=e[0];if(n.type&&!n.type.startsWith("text/")){alert("Please drop a text file");return}const r=new FileReader;r.onload=a=>{t.value=a.target.result},r.readAsText(n)}function Be(e){f.category=e,s.categoryBtns.forEach(n=>{n.classList.toggle("active",n.dataset.category===e)}),s.substitutionCiphers.classList.toggle("hidden",e!=="substitution"),s.transpositionCiphers.classList.toggle("hidden",e!=="transposition"),s.productCiphers.classList.toggle("hidden",e!=="product"),s.symmetricCiphers&&s.symmetricCiphers.classList.toggle("hidden",e!=="symmetric"),s.asymmetricCiphers&&s.asymmetricCiphers.classList.toggle("hidden",e!=="asymmetric"),s.mathTools&&s.mathTools.classList.toggle("hidden",e!=="math");let t;e==="substitution"?t="additive":e==="transposition"?t="simple-trans":e==="symmetric"?t="des":e==="asymmetric"?t="rsa":e==="math"?t="euler-phi":t="product",_(t)}function _(e){f.cipherType=e,s.cipherBtns.forEach(t=>{t.classList.toggle("active",t.dataset.cipher===e)}),N()}function L(){f.operations.clear(),s.opEncrypt.checked&&f.operations.add("encrypt"),s.opDecrypt.checked&&f.operations.add("decrypt"),s.opCrack.checked&&f.operations.add("crack");const e=f.operations.has("encrypt"),t=f.operations.has("decrypt")||f.operations.has("crack"),n=f.operations.has("encrypt")||f.operations.has("decrypt");s.encryptInputs.classList.toggle("hidden",!e&&!n),s.crackInputs.classList.toggle("hidden",!t),n&&s.encryptInputs.classList.remove("hidden");const r=[];f.operations.has("encrypt")&&r.push("ENCRYPT"),f.operations.has("decrypt")&&r.push("DECRYPT"),f.operations.has("crack")&&r.push("CRACK"),s.btnText.textContent=r.length>0?r.join(" + "):"SELECT OPERATION"}function N(){let e="";switch(f.cipherType){case"additive":e='<input type="number" id="key-k" placeholder="Key k (0-25)" min="0" max="25">';break;case"multiplicative":e='<input type="number" id="key-k" placeholder="Key k (coprime with 26)" min="1" max="25">';break;case"affine":e=`
                <input type="number" id="key-a" placeholder="a (coprime with 26)" min="1" max="25">
                <input type="number" id="key-b" placeholder="b (0-25)" min="0" max="25">
            `;break;case"monoalphabetic":e='<input type="text" id="key-word" placeholder="Keyword to generate alphabet (e.g., SECRET)">';break;case"vigenere":e='<input type="text" id="key-word" placeholder="Keyword (e.g., LEMON)">';break;case"autokey":e='<input type="number" id="key-k" placeholder="Initial key (0-25)" min="0" max="25">';break;case"playfair":e='<input type="text" id="key-word" placeholder="Keyword (e.g., MONARCHY)">';break;case"hill":e=`
                <input type="number" id="key-a" placeholder="a" min="0" max="25">
                <input type="number" id="key-b" placeholder="b" min="0" max="25">
                <input type="number" id="key-c" placeholder="c" min="0" max="25">
                <input type="number" id="key-d" placeholder="d" min="0" max="25">
            `;break;case"vernam":e='<input type="text" id="key-word" placeholder="Key (must be same length as plaintext)">';break;case"simple-trans":e='<input type="number" id="key-cols" placeholder="Number of columns (2-10)" min="2" max="10">';break;case"railfence":e='<input type="number" id="key-rails" placeholder="Number of rails (2-10)" min="2" max="20">';break;case"columnar":e='<input type="text" id="key-word" placeholder="Keyword (e.g., ZEBRA)">';break;case"double":e=`
                <input type="text" id="key-word1" placeholder="First keyword">
                <input type="text" id="key-word2" placeholder="Second keyword">
            `;break;case"des":case"aes":e=`
                <input type="text" id="key-block" placeholder="8-char key (DES) or 16-char (AES)">
                <p class="key-hint">Educational demo - shows algorithm structure</p>
            `;break;case"rsa":e=`
                <div class="rsa-inputs">
                    <input type="number" id="key-p" placeholder="Prime p (e.g., 7)">
                    <input type="number" id="key-q" placeholder="Prime q (e.g., 17)">
                    <input type="number" id="key-e" placeholder="Public exponent e (optional)">
                    <input type="number" id="key-m" placeholder="Message M (number)">
                </div>
            `;break;case"euler-phi":e='<input type="number" id="key-n" placeholder="Number n to calculate φ(n)">';break;case"ext-gcd":e=`
                <input type="number" id="key-a" placeholder="Number a">
                <input type="number" id="key-b" placeholder="Number b">
            `;break;case"mod-inverse":e=`
                <input type="number" id="key-a" placeholder="Number a">
                <input type="number" id="key-m" placeholder="Modulus m">
            `;break;case"mod-exp":e=`
                <input type="number" id="key-base" placeholder="Base">
                <input type="number" id="key-exp" placeholder="Exponent">
                <input type="number" id="key-mod" placeholder="Modulus">
            `;break;case"product":{const t=s.productSubCipher.value,n=s.productTransCipher.value;switch(e='<div class="product-key-section"><strong>Substitution Key:</strong>',t){case"additive":e+='<input type="number" id="key-sub-k" placeholder="k (0-25)" min="0" max="25">';break;case"multiplicative":e+='<input type="number" id="key-sub-k" placeholder="k (coprime)" min="1" max="25">';break;case"affine":e+=`<input type="number" id="key-sub-a" placeholder="a" min="1" max="25">
                             <input type="number" id="key-sub-b" placeholder="b" min="0" max="25">`;break;case"vigenere":case"playfair":e+='<input type="text" id="key-sub-word" placeholder="Keyword">';break;case"hill":e+=`<input type="number" id="key-sub-a" placeholder="a">
                             <input type="number" id="key-sub-b" placeholder="b">
                             <input type="number" id="key-sub-c" placeholder="c">
                             <input type="number" id="key-sub-d" placeholder="d">`;break}switch(e+="</div>",e+='<div class="product-key-section"><strong>Transposition Key:</strong>',n){case"railfence":e+='<input type="number" id="key-trans-rails" placeholder="Rails (2-20)" min="2" max="20">';break;case"columnar":e+='<input type="text" id="key-trans-word" placeholder="Keyword">';break;case"double":e+=`<input type="text" id="key-trans-word1" placeholder="First keyword">
                             <input type="text" id="key-trans-word2" placeholder="Second keyword">`;break}e+="</div>";break}}s.keyInputs.innerHTML=e}function dt(e,t){const n=["additive","multiplicative","affine","vigenere","playfair","hill"],r=["railfence","columnar","double"];let a;n.includes(e)?a="substitution":r.includes(e)?a="transposition":a="product",Be(a),_(e),s.opCrack.checked=!0,s.opEncrypt.checked=!1,s.opDecrypt.checked=!1,L(),s.ciphertextInput.value=t}async function ut(){if(!f.isProcessing){if(f.operations.size===0){alert("Please select at least one operation");return}f.isProcessing=!0,bt(),s.emptyState.classList.add("hidden"),await new Promise(e=>setTimeout(e,100));try{let e=null;if(f.operations.has("encrypt")&&(e=pt(),!e)){f.isProcessing=!1;return}if(f.operations.has("decrypt")&&(e&&(s.ciphertextInput.value=e),!yt()&&f.operations.size===1)){f.isProcessing=!1;return}f.operations.has("crack")?(e&&!f.operations.has("decrypt")&&(s.ciphertextInput.value=e),await ft()):m()}catch(e){console.error("Execution error:",e),alert("Error: "+e.message),m()}f.isProcessing=!1}}function pt(){const e=g.cleanText(s.plaintextInput.value);if(!e){m(),alert("Please enter plaintext to encrypt");return}let t;switch(f.cipherType){case"additive":{const r=parseInt(document.getElementById("key-k").value);if(isNaN(r)||r<0||r>25){m(),alert("Key must be between 0 and 25");return}t=g.encryptAdditive(e,r);break}case"multiplicative":{const r=parseInt(document.getElementById("key-k").value);if(isNaN(r)||!g.getValidMultiplicativeKeys().includes(r)){m(),alert("Key must be coprime with 26 (valid: 1,3,5,7,9,11,15,17,19,21,23,25)");return}t=g.encryptMultiplicative(e,r);break}case"affine":{const r=parseInt(document.getElementById("key-a").value),a=parseInt(document.getElementById("key-b").value);if(isNaN(r)||!g.getValidMultiplicativeKeys().includes(r)){m(),alert("a must be coprime with 26");return}if(isNaN(a)||a<0||a>25){m(),alert("b must be between 0 and 25");return}t=g.encryptAffine(e,r,a);break}case"vigenere":{const r=document.getElementById("key-word").value.toUpperCase();if(!r){m(),alert("Please enter a keyword");return}t=g.encryptVigenere(e,r);break}case"playfair":{const r=document.getElementById("key-word").value.toUpperCase();if(!r){m(),alert("Please enter a keyword");return}t=g.encryptPlayfair(e,r);break}case"hill":{const r=parseInt(document.getElementById("key-a").value),a=parseInt(document.getElementById("key-b").value),i=parseInt(document.getElementById("key-c").value),o=parseInt(document.getElementById("key-d").value);if([r,a,i,o].some(isNaN)){m(),alert("Please enter all matrix values (a,b,c,d)");return}t=g.encryptHill(e,[[r,a],[i,o]]);break}case"railfence":{const r=parseInt(document.getElementById("key-rails").value);if(isNaN(r)||r<2){m(),alert("Rails must be at least 2");return}t=g.encryptRailFence(e,r);break}case"columnar":{const r=document.getElementById("key-word").value.toUpperCase();if(!r){m(),alert("Please enter a keyword");return}t=g.encryptColumnar(e,r);break}case"double":{const r=document.getElementById("key-word1").value.toUpperCase(),a=document.getElementById("key-word2").value.toUpperCase();if(!r||!a){m(),alert("Please enter both keywords");return}t=g.encryptDoubleTransposition(e,r,a);break}case"product":{const r=s.productSubCipher.value,a=s.productTransCipher.value;let i={};try{switch(r){case"additive":case"multiplicative":if(i={k:parseInt(document.getElementById("key-sub-k").value)},isNaN(i.k))throw new Error("Invalid key");break;case"affine":if(i={a:parseInt(document.getElementById("key-sub-a").value),b:parseInt(document.getElementById("key-sub-b").value)},isNaN(i.a)||isNaN(i.b))throw new Error("Invalid key");break;case"vigenere":case"playfair":if(i={word:document.getElementById("key-sub-word").value.toUpperCase()},!i.word)throw new Error("Invalid key");break;case"hill":i={matrix:[[parseInt(document.getElementById("key-sub-a").value),parseInt(document.getElementById("key-sub-b").value)],[parseInt(document.getElementById("key-sub-c").value),parseInt(document.getElementById("key-sub-d").value)]]};break}}catch{m(),alert("Please enter valid substitution key");return}let o={};try{switch(a){case"railfence":if(o={rails:parseInt(document.getElementById("key-trans-rails").value)},isNaN(o.rails)||o.rails<2)throw new Error("Invalid rails");break;case"columnar":if(o={word:document.getElementById("key-trans-word").value.toUpperCase()},!o.word)throw new Error("Invalid key");break;case"double":if(o={word1:document.getElementById("key-trans-word1").value.toUpperCase(),word2:document.getElementById("key-trans-word2").value.toUpperCase()},!o.word1||!o.word2)throw new Error("Invalid keys");break}}catch{m(),alert("Please enter valid transposition key");return}const c=g.encryptProductCipherFlexible(e,r,i,a,o),l=r.charAt(0).toUpperCase()+r.slice(1),d=a.charAt(0).toUpperCase()+a.slice(1);return s.cipherResult.innerHTML=`
                <div style="margin-bottom: 0.5rem;">After ${l}: ${c.afterSubstitution}</div>
                <div>Final Product: ${c.finalCipher}</div>
            `,s.encryptionOutput.querySelector("h3").textContent=`Encrypted (${l} + ${d})`,s.encryptionOutput.classList.remove("hidden"),s.emptyState.classList.add("hidden"),c.finalCipher}}const n=s.encryptionOutput.querySelector("h3");return n&&(n.textContent="Encrypted Ciphertext"),s.cipherResult.textContent=t,s.encryptionOutput.classList.remove("hidden"),s.emptyState.classList.add("hidden"),X("ENCRYPT",e,t),t}function yt(){var n,r,a,i,o,c,l,d,p,y,x,B,P,G,J,z,Q,ee,te,ne,re,ae,ie,se,oe,ce;const e=g.cleanText(s.ciphertextInput.value);if(!e){m(),alert("Please enter ciphertext to decrypt");return}s.encryptInputs.classList.remove("hidden");let t;switch(f.cipherType){case"additive":{const u=parseInt((n=document.getElementById("key-k"))==null?void 0:n.value);if(isNaN(u)||u<0||u>25){m(),alert("Please enter a valid key (0-25) in the Encryption Key field");return}t=g.decryptAdditive(e,u);break}case"multiplicative":{const u=parseInt((r=document.getElementById("key-k"))==null?void 0:r.value);if(isNaN(u)||!g.getValidMultiplicativeKeys().includes(u)){m(),alert("Please enter a valid key (coprime with 26)");return}t=g.decryptMultiplicative(e,u);break}case"affine":{const u=parseInt((a=document.getElementById("key-a"))==null?void 0:a.value),v=parseInt((i=document.getElementById("key-b"))==null?void 0:i.value);if(isNaN(u)||!g.getValidMultiplicativeKeys().includes(u)){m(),alert("Please enter valid key a (coprime with 26)");return}if(isNaN(v)||v<0||v>25){m(),alert("Please enter valid key b (0-25)");return}t=g.decryptAffine(e,u,v);break}case"vigenere":{const u=(o=document.getElementById("key-word"))==null?void 0:o.value.toUpperCase();if(!u){m(),alert("Please enter a keyword");return}t=g.decryptVigenere(e,u);break}case"playfair":{const u=(c=document.getElementById("key-word"))==null?void 0:c.value.toUpperCase();if(!u){m(),alert("Please enter a keyword");return}t=g.decryptPlayfair(e,u);break}case"hill":{const u=parseInt((l=document.getElementById("key-a"))==null?void 0:l.value),v=parseInt((d=document.getElementById("key-b"))==null?void 0:d.value),E=parseInt((p=document.getElementById("key-c"))==null?void 0:p.value),I=parseInt((y=document.getElementById("key-d"))==null?void 0:y.value);if([u,v,E,I].some(isNaN)){m(),alert("Please enter all matrix values (a,b,c,d)");return}t=g.decryptHill(e,[[u,v],[E,I]]);break}case"railfence":{const u=parseInt((x=document.getElementById("key-rails"))==null?void 0:x.value);if(isNaN(u)||u<2){m(),alert("Please enter number of rails (2+)");return}t=g.decryptRailFence(e,u);break}case"columnar":{const u=(B=document.getElementById("key-word"))==null?void 0:B.value.toUpperCase();if(!u){m(),alert("Please enter a keyword");return}t=g.decryptColumnar(e,u);break}case"double":{const u=(P=document.getElementById("key-word1"))==null?void 0:P.value.toUpperCase(),v=(G=document.getElementById("key-word2"))==null?void 0:G.value.toUpperCase();if(!u||!v){m(),alert("Please enter both keywords");return}t=g.decryptDoubleTransposition(e,u,v);break}case"product":{const u=s.productSubCipher.value,v=s.productTransCipher.value;let E={};try{switch(u){case"additive":case"multiplicative":if(E={k:parseInt((J=document.getElementById("key-sub-k"))==null?void 0:J.value)},isNaN(E.k))throw new Error("Invalid key");break;case"affine":if(E={a:parseInt((z=document.getElementById("key-sub-a"))==null?void 0:z.value),b:parseInt((Q=document.getElementById("key-sub-b"))==null?void 0:Q.value)},isNaN(E.a)||isNaN(E.b))throw new Error("Invalid key");break;case"vigenere":case"playfair":if(E={word:(ee=document.getElementById("key-sub-word"))==null?void 0:ee.value.toUpperCase()},!E.word)throw new Error("Invalid key");break;case"hill":E={matrix:[[parseInt((te=document.getElementById("key-sub-a"))==null?void 0:te.value),parseInt((ne=document.getElementById("key-sub-b"))==null?void 0:ne.value)],[parseInt((re=document.getElementById("key-sub-c"))==null?void 0:re.value),parseInt((ae=document.getElementById("key-sub-d"))==null?void 0:ae.value)]]};break}}catch{return m(),alert("Please enter valid substitution key"),null}let I={};try{switch(v){case"railfence":if(I={rails:parseInt((ie=document.getElementById("key-trans-rails"))==null?void 0:ie.value)},isNaN(I.rails)||I.rails<2)throw new Error("Invalid rails");break;case"columnar":if(I={word:(se=document.getElementById("key-trans-word"))==null?void 0:se.value.toUpperCase()},!I.word)throw new Error("Invalid key");break;case"double":if(I={word1:(oe=document.getElementById("key-trans-word1"))==null?void 0:oe.value.toUpperCase(),word2:(ce=document.getElementById("key-trans-word2"))==null?void 0:ce.value.toUpperCase()},!I.word1||!I.word2)throw new Error("Invalid keys");break}}catch{return m(),alert("Please enter valid transposition key"),null}const K=g.decryptProductCipherFlexible(e,u,E,v,I),Ae=u.charAt(0).toUpperCase()+u.slice(1),le=v.charAt(0).toUpperCase()+v.slice(1);return s.cipherResult.innerHTML=`
                <div style="margin-bottom: 0.5rem;">After ${le} Reverse: ${K.afterTransposition}</div>
                <div>Final Plaintext: ${K.plaintext}</div>
            `,s.encryptionOutput.querySelector("h3").textContent=`Decrypted (${Ae} + ${le})`,s.encryptionOutput.classList.remove("hidden"),s.emptyState.classList.add("hidden"),K.plaintext}}return t?(s.cipherResult.textContent=t,s.encryptionOutput.querySelector("h3").textContent="Decrypted Plaintext",s.encryptionOutput.classList.remove("hidden"),s.emptyState.classList.add("hidden"),X("DECRYPT",e,t),t):(m(),alert("Decryption failed - invalid key"),null)}let C=null;function mt(){C&&(C.terminate(),C=null)}function ft(){const e=g.cleanText(s.ciphertextInput.value);return e?new Promise((t,n)=>{mt(),C=new Worker(new URL("/assets/worker-DxbFCdbt.js",import.meta.url),{type:"module"});const r={subType:s.productSubCipher.value,transType:s.productTransCipher.value};C.onmessage=function(a){const i=a.data;i.type==="progress"?ht(i.message):i.type==="complete"?(X("CRACK",e,i.results),gt(i.results),m(),t()):i.type==="error"&&(m(),n(new Error(i.message)))},C.onerror=function(a){m(),n(new Error("Worker error: "+a.message))},C.postMessage({type:"crack",cipher:f.cipherType,text:e,options:r})}):(m(),alert("Please enter ciphertext to crack"),Promise.resolve())}function ht(e){const t=s.loadingState.querySelector(".loading-text");t&&(t.textContent=e)}function gt(e){if(!e||e.length===0){s.emptyState.innerHTML="<h3>No candidates found</h3>",s.emptyState.classList.remove("hidden"),s.topCandidates.classList.add("hidden"),s.allResultsToggle.classList.add("hidden");return}s.emptyState.classList.add("hidden"),s.topCandidates.classList.remove("hidden"),s.allResultsToggle.classList.remove("hidden");const t=e.slice(0,5);s.candidatesContainer.innerHTML=t.map((n,r)=>`
        <div class="candidate-card">
            <div class="candidate-rank">#${r+1}</div>
            <div class="candidate-info">
                <div class="candidate-key">${n.keyDisplay}</div>
                <div class="candidate-text">${n.plaintext}</div>
            </div>
            <div class="candidate-score">
                <div class="score-value ${kt(n.confidence)}">${n.confidence}%</div>
                <div class="score-label">Confidence</div>
            </div>
        </div>
    `).join(""),s.allResultsContainer.innerHTML=e.map(n=>`
        <div class="result-row">
            <span class="key">${n.keyDisplay}</span>
            <span class="plaintext">${n.plaintext}</span>
            <span class="score">${n.confidence}%</span>
        </div>
    `).join("")}function kt(e){return e>=60?"confidence-high":e>=30?"confidence-medium":"confidence-low"}function bt(){s.emptyState.classList.add("hidden"),s.topCandidates.classList.add("hidden"),s.allResultsToggle.classList.add("hidden"),s.allResults.classList.add("hidden"),s.loadingState.classList.remove("hidden")}function m(){s.loadingState.classList.add("hidden")}function vt(){const e=s.allResults.classList.toggle("hidden");s.toggleAllBtn.textContent=e?"Show All Results":"Hide All Results"}function Et(){s.plaintextInput.value="",s.ciphertextInput.value="",s.encryptionOutput.classList.add("hidden"),s.topCandidates.classList.add("hidden"),s.allResultsToggle.classList.add("hidden"),s.allResults.classList.add("hidden"),s.emptyState.classList.remove("hidden"),s.keyInputs.querySelectorAll("input").forEach(t=>t.value="")}const Le=document.createElement("style");Le.textContent=".hidden { display: none !important; }";document.head.appendChild(Le);function It(){const e=document.body,t=document.getElementById("theme-icon");e.getAttribute("data-theme")==="dark"?(e.removeAttribute("data-theme"),t.textContent="DARK MODE",localStorage.setItem("theme","light")):(e.setAttribute("data-theme","dark"),t.textContent="LIGHT MODE",localStorage.setItem("theme","dark"))}function wt(){const e=localStorage.getItem("theme"),t=document.getElementById("theme-icon");e==="dark"?(document.body.setAttribute("data-theme","dark"),t&&(t.textContent="LIGHT MODE")):t&&(t.textContent="DARK MODE")}document.addEventListener("DOMContentLoaded",it);
